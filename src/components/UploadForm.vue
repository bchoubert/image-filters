<template>
  <div id="upload-form" v-bind:class="{ collapsed: !!images.length }">
    <input id="picture-input" type="file" accept="image/*" @change="this.onImageInputChange" />
    <label for="picture-input" aria-label="Picture to upload" v-if="!images.length">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 104.632 104.632" height="104.632" width="104.632" aria-hidden="true">
        <g style="fill:#ffffff" transform="matrix(1,0,0,-1,0,104.63208)">
          <path style="stroke:none" d="m 52.31604,104.13208 c -6.995335,0 -13.781158,-1.36993 -20.169014,-4.07175 C 29.076813,98.761757 26.115561,97.154442 23.345533,95.283028 20.601694,93.429337 18.021481,91.300453 15.676574,88.955536 13.331614,86.610588 11.202746,84.030373 9.3490667,81.286545 7.4776802,78.516548 5.8703599,75.55529 4.5717602,72.485054 1.8699334,66.097229 0.50000006,59.311386 0.50000006,52.31604 c 0,-6.995335 1.36993334,-13.781174 4.07176014,-20.169014 1.298573,-3.070213 2.9058933,-6.031465 4.7773065,-8.801493 C 11.20272,20.601734 13.3316,18.021521 15.67656,15.676574 18.021521,13.3316 20.601734,11.20272 23.345533,9.3490667 26.115561,7.4776535 29.076813,5.8703332 32.147026,4.5717602 38.534866,1.8699334 45.320705,0.50000006 52.31604,0.50000006 c 6.995346,0 13.781189,1.36993334 20.169014,4.07176014 3.070236,1.2985997 6.031494,2.90592 8.801491,4.7773065 2.743828,1.8536793 5.324043,3.9825473 7.668976,6.3274933 2.344932,2.344921 4.473816,4.925134 6.327507,7.668973 1.871414,2.770028 3.478729,5.73128 4.777302,8.801493 2.70182,6.387856 4.07175,13.173679 4.07175,20.169014 0,6.995346 -1.36993,13.781174 -4.07175,20.169014 -1.298596,3.070236 -2.905919,6.031494 -4.777302,8.801491 -1.853722,2.743866 -3.98259,5.324081 -6.327492,7.668976 -2.34491,2.344917 -4.925125,4.473785 -7.668991,6.327507 -2.769997,1.871383 -5.731255,3.478706 -8.801491,4.777302 -6.38784,2.70182 -13.173668,4.07175 -20.169014,4.07175 z m -27.095293,-43.945358 1.154213,0.895103 25.634668,19.880013 0.306412,0.237633 0.306412,-0.237633 25.635147,-19.880013 1.154243,-0.895103 H 77.951187 63.279625 v -36.121376 -0.5 h -0.5 -20.926693 -0.5 v 0.5 36.121376 H 26.681374 Z" />
          <path style="fill:#ffffff;stroke:none" d="m 52.31604,103.63208 c 6.928059,0 13.648354,-1.35664 19.974243,-4.032242 3.040497,-1.286026 5.973114,-2.8778 8.71637,-4.731125 2.717476,-1.835884 5.272903,-3.944313 7.595329,-6.266731 2.322418,-2.322426 4.430847,-4.877853 6.266747,-7.595344 1.853309,-2.743241 3.445083,-5.675858 4.731109,-8.71634 2.675602,-6.325904 4.032242,-13.046199 4.032242,-19.974258 0,-6.928043 -1.35664,-13.648342 -4.032242,-19.974243 C 98.313843,29.30134 96.722054,26.368725 94.868713,23.625425 93.032814,20.90794 90.924385,18.352512 88.601982,16.030111 86.27951,13.707654 83.724083,11.599226 81.006638,9.7633686 78.263397,7.9100542 75.33078,6.3182831 72.290283,5.0322542 65.964409,2.3566401 59.24411,0.9999972 52.31604,0.9999972 c -6.928059,0 -13.648357,1.3566429 -19.974243,4.032257 -3.040457,1.2860003 -5.973072,2.8777857 -8.716372,4.7311287 -2.717441,1.8358571 -5.272871,3.9442851 -7.595314,6.2667441 -2.322443,2.322427 -4.430871,4.877857 -6.2667281,7.595314 -1.853343,2.743284 -3.4451284,5.675899 -4.7311287,8.716371 -2.6756141,6.325871 -4.032257,13.046169 -4.032257,19.974228 0,6.92807 1.3566429,13.648369 4.032257,19.974243 1.2860289,3.040497 2.8778,5.973114 4.7311287,8.71637 1.8358431,2.71743 3.9442711,5.272857 6.2667441,7.595329 2.322385,2.322403 4.877813,4.430832 7.595314,6.266731 2.743284,1.853341 5.675899,3.44513 8.716356,4.731125 6.325901,2.675602 13.0462,4.032242 19.974243,4.032242 M 23.760111,59.686726 h 2.921257 14.171556 v -35.621373 -1 h 1 20.926701 1 v 1 35.621373 H 77.95118 80.872482 L 78.563995,61.476955 52.928856,81.356972 52.31604,81.832214 51.703213,81.356956 26.068541,61.47694 23.760111,59.686726 M 52.31604,104.63208 c -7.062614,0 -13.913986,-1.38322 -20.363785,-4.11124 -3.099943,-1.311154 -6.08983,-2.934017 -8.886629,-4.823498 -2.770229,-1.871529 -5.375215,-4.020844 -7.742615,-6.38826 C 12.955597,86.941666 10.806269,84.336685 8.9347544,81.566452 7.0452685,78.769669 5.4224114,75.77977 4.1112542,72.67984 1.3832258,66.230042 -2.8180802e-6,59.37867 -2.8180802e-6,52.31604 -2.8180802e-6,45.253426 1.3832258,38.402054 4.1112542,31.952255 c 1.3111572,-3.099943 2.9340143,-6.08983 4.8235002,-8.886629 1.8715146,-2.770229 4.0208426,-5.375215 6.3882566,-7.742615 2.3674,-2.367414 4.972386,-4.516742 7.742615,-6.3882566 2.796799,-1.8894859 5.786686,-3.512343 8.886629,-4.8235002 C 38.402054,1.3832258 45.253426,-2.8180802e-6 52.31604,-2.8180802e-6 c 7.06263,0 13.914002,1.3832286180802 20.3638,4.1112570180802 3.09993,1.3111572 6.089829,2.9340143 8.886612,4.8235002 2.770233,1.8715146 5.375214,4.0208426 7.74263,6.3882566 2.367416,2.3674 4.516731,4.972386 6.38826,7.742615 1.889481,2.796799 3.512344,5.786686 4.823498,8.886629 2.72802,6.449799 4.11124,13.301171 4.11124,20.363785 0,7.06263 -1.38322,13.914002 -4.11124,20.3638 -1.311154,3.09993 -2.934017,6.089829 -4.823498,8.886612 -1.871529,2.770233 -4.020844,5.375214 -6.38826,7.74263 -2.367416,2.367416 -4.972397,4.516731 -7.74263,6.38826 -2.796783,1.889481 -5.786682,3.512344 -8.886612,4.823498 -6.449798,2.72802 -13.30117,4.11124 -20.3638,4.11124 z M 26.681368,60.686726 52.31604,80.566742 77.95118,60.686726 H 62.779625 V 24.065353 H 41.852924 v 36.621373 z" />
        </g>
      </svg>
      Upload your picture
    </label>
    <span v-if="!!images.length && !!name">
      Picture uploaded: {{ name }}
    </span>
    <span id="upload-another" @click="resetAll" @keydown.enter="resetAll" @keydown.space="resetAll" v-if="!!images.length" tabindex="0">
      Upload another picture?
    </span>
  </div>
</template>

<script>
export default {
  name: 'upload-form',
  components: {},
  props: ['images'],
  data() {
    return {
      fileInput: null,
      name: null
    };
  },
  mounted() {
    this.fileInput = document.querySelector('#picture-input');
  },
  methods: {
    onImageInputChange(e) {
      if(!e.target.files) { return; }

      const image = e.target.files[0];
      this.name = image.name;

      createImageBitmap(image).then((bitmap) => {
        this.addImage({
          width: bitmap.width,
          height: bitmap.height,
          bitmap: bitmap,
          data: null,

          name: image.name
        });

        this.fileInput.value = null;
      });

    },
    addImage(image) {
      this.$emit('image-add', image);
    },
    resetAll(e) {
      e.preventDefault();
      this.$emit('reset-all', null);
      return false;
    }
  }
}
</script>

<style scoped>
#upload-form {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  transition: flex .5s;
}

#upload-form.collapsed {
  flex-basis: 3em;
  flex-grow: 0;
}

#picture-input {
  width: 0;
  height: 0;
  display: block;
  overflow: hidden;
}

#picture-input + label {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  padding: 1em;
}

#picture-input + label svg {
  height: 4em;
  margin-bottom: 1em;
}

#picture-input:focus + label {
  border: 2px solid lightgray;
}

#upload-another {
  margin-top: .5em;
  cursor: pointer;
}

#upload-another:focus {
  outline: 2px solid lightgray;
}
</style>